<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="utf-8" />
    <title>BIT ÂêÉÈ•≠Âπ¥Â∫¶Êä•Âëä</title>
    <style>
        :root {
            --bg-page: #F7F2C4;
            --color-header: #34C759;
            --color-avatar-wrapper: #FF69B4;
            --color-avatar: #FFDB58;
            --color-achievements: #A388EE;
            --color-button: #FFDB58;
            --color-icon: #FFA07A;
            --color-card1: #FFA07A;
            --color-card2: #7DF9FF;
            --color-card3: #90EE90;
            --color-card4: #FF6B6B;
            --color-day-detail: #FDFD96;
            --color-modal-header: #34C759;
            --color-time-badge: #FFDB58;
            --heatmap-0: #f5f5f5;
            --heatmap-1: #FFA07A;
            --heatmap-2: #FF7A5C;
            --heatmap-3: #FF6B6B;
            --heatmap-4: #FF4911;
        }
        
        * {
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
            margin: 0;
            padding: 0;
            background-color: var(--bg-page);
            min-height: 100vh;
        }

        .page {
            max-width: 1100px;
            margin: 0 auto;
            padding: 24px;
        }

        .page-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
            padding: 16px 24px;
            background-color: var(--color-header);
            border: 4px solid #000;
        }

        .header-title {
            font-size: 32px;
            font-weight: 900;
            margin: 0;
            text-transform: uppercase;
            letter-spacing: -1px;
        }

        #save-to-link {
            padding: 10px 20px;
            font-size: 14px;
            font-weight: 700;
            border: 3px solid #000;
            background-color: var(--color-button);
            color: #000;
            cursor: pointer;
            box-shadow: 4px 4px 0 #000;
            transition: all 0.1s ease;
            text-transform: uppercase;
        }

        #save-to-link:hover {
            transform: translate(2px, 2px);
            box-shadow: 2px 2px 0 #000;
        }

        #save-to-link:active {
            transform: translate(4px, 4px);
            box-shadow: 0 0 0 #000;
        }

        .layout {
            display: flex;
            align-items: flex-start;
            gap: 24px;
        }

        .sidebar {
            width: 320px;
            flex-shrink: 0;
        }

        .main {
            flex: 1;
            min-width: 0;
        }

        .avatar-wrapper {
            text-align: center;
            margin-bottom: 20px;
            padding: 20px;
            background-color: var(--color-avatar-wrapper);
            border: 4px solid #000;
        }

        .avatar {
            width: 180px;
            height: 180px;
            border: 4px solid #000;
            overflow: hidden;
            background: var(--color-avatar);
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-size: 64px;
            color: #000;
            cursor: pointer;
        }

        .avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .avatar-hint {
            margin-top: 12px;
            font-size: 12px;
            color: #000;
            font-weight: 600;
        }

        .avatar-upload-button {
            margin-top: 8px;
            font-size: 12px;
            padding: 6px 12px;
            border: 2px solid #000;
            background-color: #fff;
            color: #000;
            cursor: pointer;
            font-weight: 700;
            box-shadow: 2px 2px 0 #000;
        }

        .avatar-upload-button:hover {
            transform: translate(1px, 1px);
            box-shadow: 1px 1px 0 #000;
        }

        .profile-name {
            font-size: 18px;
            font-weight: 800;
            margin: 0 0 16px 0;
            text-align: center;
            padding: 12px;
            background-color: #fff;
            border: 3px solid #000;
        }

        .profile-subtitle {
            font-size: 13px;
            color: #000;
            text-align: center;
            margin-bottom: 16px;
            font-weight: 600;
        }

        #year-switcher {
            margin-bottom: 16px;
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .year-button {
            display: inline-block;
            padding: 8px 16px;
            border: 3px solid #000;
            cursor: pointer;
            font-size: 14px;
            font-weight: 700;
            background-color: #fff;
            box-shadow: 3px 3px 0 #000;
            transition: all 0.1s ease;
        }

        .year-button:hover {
            transform: translate(1px, 1px);
            box-shadow: 2px 2px 0 #000;
        }

        .year-button.active {
            background-color: #000;
            color: #fff;
            transform: translate(3px, 3px);
            box-shadow: 0 0 0 #000;
        }

        /* ‰∏ÄÁúºÊÄªËßà */
        #summary-section {
            margin-top: 0;
        }

        .summary-grid {
            display: grid;
            grid-template-columns: repeat(2, minmax(0, 1fr));
            gap: 12px;
        }

        .summary-card {
            background-color: #fff;
            border: 3px solid #000;
            padding: 12px 14px;
        }

        .summary-card:nth-child(1) {
            background-color: var(--color-card1);
        }

        .summary-card:nth-child(2) {
            background-color: var(--color-card2);
        }

        .summary-card:nth-child(3) {
            background-color: var(--color-card3);
        }

        .summary-card:nth-child(4) {
            background-color: var(--color-card4);
        }

        .summary-card-label {
            font-size: 12px;
            color: #000;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .summary-card-value {
            margin-top: 6px;
            font-size: 20px;
            font-weight: 900;
        }

        .summary-highlight {
            margin-top: 16px;
            font-size: 13px;
            color: #000;
            font-weight: 600;
            padding: 12px;
            background-color: #fff;
            border: 3px solid #000;
        }

        /* ÊàêÂ∞±Âå∫Âüü */
        #achievements-section {
            margin-bottom: 24px;
            padding: 20px;
            background-color: var(--color-achievements);
            border: 4px solid #000;
        }

        #achievements-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        #achievements-header h2 {
            margin: 0;
            font-size: 24px;
            font-weight: 900;
            text-transform: uppercase;
        }

        #view-all-achievements {
            padding: 8px 16px;
            font-size: 12px;
            font-weight: 700;
            border: 3px solid #000;
            background-color: var(--color-button);
            color: #000;
            cursor: pointer;
            box-shadow: 3px 3px 0 #000;
            transition: all 0.1s ease;
            text-transform: uppercase;
        }

        #view-all-achievements:hover {
            transform: translate(1px, 1px);
            box-shadow: 2px 2px 0 #000;
        }

        .achievements-grid {
            display: grid;
            grid-template-columns: repeat(2, minmax(0, 1fr));
            gap: 12px;
        }

        .achievement-card {
            display: flex;
            padding: 12px;
            border: 3px solid #000;
            background-color: #fff;
            box-shadow: 4px 4px 0 #000;
        }

        .achievement-time {
            margin-left: auto;
            font-size: 10px;
            color: #000;
            font-weight: 600;
            align-self: flex-start;
            background-color: var(--color-time-badge);
            padding: 2px 6px;
            border: 2px solid #000;
        }

        .achievement-card.locked {
            opacity: 0.5;
            background-color: #e5e5e5;
        }

        .achievement-icon {
            width: 48px;
            height: 48px;
            border: 3px solid #000;
            background-color: var(--color-icon);
            margin-right: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            flex-shrink: 0;
        }

        .achievement-text {
            display: flex;
            flex-direction: column;
            justify-content: center;
            min-width: 0;
        }

        .achievement-title {
            font-size: 14px;
            font-weight: 800;
        }

        .achievement-desc {
            font-size: 11px;
            color: #000;
            font-weight: 500;
            margin-top: 2px;
        }

        /* ÊàêÂ∞±ÂºπÁ™ó */
        .modal {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .modal.hidden {
            display: none;
        }

        .modal-content {
            background: #fff;
            border: 4px solid #000;
            width: 520px;
            max-height: 80vh;
            display: flex;
            flex-direction: column;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px 20px;
            border-bottom: 4px solid #000;
            background-color: var(--color-modal-header);
        }

        .modal-header h2 {
            margin: 0;
            font-size: 20px;
            font-weight: 900;
            text-transform: uppercase;
        }

        #close-achievements-modal {
            background: #000;
            border: none;
            font-size: 20px;
            line-height: 1;
            cursor: pointer;
            padding: 4px 10px;
            color: #fff;
            font-weight: 900;
        }

        #close-achievements-modal:hover {
            background: #333;
        }

        .modal-footer {
            padding: 12px 20px;
            border-top: 4px solid #000;
            background-color: #f5f5f5;
            font-weight: 700;
        }

        .hidden-achievements-hint {
            color: #dc2626;
            margin-left: 4px;
            font-weight: 800;
        }

        .modal-body {
            padding: 16px 20px;
            overflow-y: auto;
        }

        .all-achievement-row {
            display: flex;
            align-items: center;
            padding: 10px;
            cursor: pointer;
            border: 3px solid #000;
            margin-bottom: 8px;
            background-color: #fff;
        }

        .all-achievement-row:hover {
            background-color: #f5f5f5;
        }

        .all-achievement-row.locked {
            cursor: default;
            opacity: 0.5;
            background-color: #e5e5e5;
        }

        .all-achievement-row .achievement-icon {
            flex-shrink: 0;
        }

        .all-achievement-info {
            flex: 1;
            margin-left: 8px;
        }

        .all-achievement-meta {
            display: flex;
            flex-direction: column;
        }

        .all-achievement-unlock-time {
            font-size: 11px;
            color: #000;
            text-align: right;
            width: 120px;
            font-weight: 700;
            background-color: #FFDB58;
            padding: 4px 8px;
            border: 2px solid #000;
        }

        .pin-checkbox {
            margin-right: 10px;
            width: 20px;
            height: 20px;
            accent-color: #000;
            cursor: pointer;
        }

        .pin-checkbox:disabled {
            opacity: 0.4;
            cursor: not-allowed;
        }

        /* È•≠ÂäõÂõæÂå∫Âüü */
        #heatmap-container {
            margin-top: 0;
            overflow-x: auto;
            padding: 20px;
            background-color: #fff;
            border: 4px solid #000;
        }

        #heatmap {
            position: relative;
        }

        .heatmap-scroll {
            display: inline-block;
        }

        .heatmap-grid {
            display: grid;
            grid-auto-flow: column;
            grid-auto-columns: 14px;
            grid-template-rows: repeat(7, 14px);
            gap: 3px;
        }

        .day-cell {
            width: 14px;
            height: 14px;
            background-color: var(--heatmap-0);
            cursor: pointer;
            border: 2px solid #000;
        }

        .day-cell.level-0 {
            background-color: var(--heatmap-0);
        }

        .day-cell.level-1 {
            background-color: var(--heatmap-1);
        }

        .day-cell.level-2 {
            background-color: var(--heatmap-2);
        }

        .day-cell.level-3 {
            background-color: var(--heatmap-3);
        }

        .day-cell.level-4 {
            background-color: var(--heatmap-4);
        }

        .day-cell:hover {
            transform: scale(1.2);
            z-index: 10;
            position: relative;
        }

        .weekday-labels {
            display: grid;
            grid-template-rows: repeat(7, 14px);
            row-gap: 3px;
            font-size: 11px;
            color: #000;
            margin-right: 6px;
            padding-top: 28px;
            font-weight: 700;
        }

        .weekday-labels div {
            line-height: 14px;
        }

        .month-labels {
            display: grid;
            grid-auto-flow: column;
            grid-auto-columns: 14px;
            column-gap: 3px;
            font-size: 11px;
            color: #000;
            margin-bottom: 6px;
            font-weight: 700;
        }

        .month-labels div {
            text-align: center;
        }

        #day-detail {
            margin-top: 20px;
            font-size: 13px;
            padding: 16px;
            background-color: var(--color-day-detail);
            border: 3px solid #000;
        }

        #day-detail:empty {
            display: none;
        }

        #day-detail h2 {
            margin: 0 0 12px 0;
            font-size: 18px;
            font-weight: 900;
            text-transform: uppercase;
        }

        #day-detail p {
            margin: 0 0 12px 0;
            font-weight: 600;
        }

        #day-detail ul {
            padding-left: 20px;
            margin: 0;
        }

        #day-detail li {
            margin-bottom: 4px;
            font-weight: 500;
        }

        @media (max-width: 900px) {
            .layout {
                flex-direction: column;
            }

            .sidebar {
                width: 100%;
            }

            .avatar {
                width: 140px;
                height: 140px;
            }

            .achievements-grid {
                grid-template-columns: minmax(0, 1fr);
            }

            .page-header {
                flex-direction: column;
                gap: 12px;
                text-align: center;
            }

            .header-title {
                font-size: 24px;
            }
        }

        /* ÈÖçËâ≤Èù¢Êùø */
        #color-panel {
            position: fixed;
            top: 0;
            right: 0;
            width: 280px;
            height: 100vh;
            background: #1a1a1a;
            color: #fff;
            overflow-y: auto;
            padding: 16px;
            border-left: 4px solid #000;
            z-index: 9999;
            transform: translateX(100%);
            transition: transform 0.3s ease;
        }
        
        #color-panel.open {
            transform: translateX(0);
        }
        
        #color-panel-toggle {
            position: fixed;
            top: 50%;
            right: 0;
            transform: translateY(-50%);
            background: #000;
            color: #fff;
            border: 3px solid #000;
            padding: 12px 8px;
            cursor: pointer;
            font-weight: 900;
            font-size: 14px;
            writing-mode: vertical-rl;
            z-index: 9998;
            transition: right 0.3s ease;
        }
        
        #color-panel-toggle.shifted {
            right: 280px;
        }
        
        #color-panel h3 {
            font-size: 16px;
            margin: 0 0 16px 0;
            padding-bottom: 8px;
            border-bottom: 2px solid #333;
        }
        
        .color-group {
            margin-bottom: 16px;
        }
        
        .color-group-title {
            font-size: 11px;
            font-weight: 700;
            color: #888;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 8px;
        }
        
        .color-item {
            margin-bottom: 12px;
            opacity: 0.5;
            transition: opacity 0.15s ease;
        }
        
        .color-item:hover {
            opacity: 1;
        }
        
        .color-item-header {
            display: flex;
            align-items: center;
            margin-bottom: 4px;
            gap: 8px;
        }
        
        .color-item label {
            flex: 1;
            font-size: 12px;
            font-weight: 600;
        }
        
        .color-preview {
            width: 24px;
            height: 24px;
            border: 2px solid #000;
        }
        
        .color-item .hex {
            font-family: monospace;
            font-size: 10px;
            color: #888;
            background: transparent;
            border: 1px solid transparent;
            padding: 2px 4px;
            width: 65px;
            cursor: text;
        }
        
        .color-item .hex:hover,
        .color-item .hex:focus {
            border-color: #444;
            background: #222;
            outline: none;
            color: #fff;
        }
        
        .hsl-sliders {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }
        
        .slider-row {
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .slider-row span {
            font-size: 10px;
            color: #666;
            width: 14px;
        }
        
        .slider-row input[type="range"] {
            flex: 1;
            height: 12px;
            -webkit-appearance: none;
            appearance: none;
            background: #333;
            border-radius: 6px;
            cursor: pointer;
            border: 1px solid #000;
        }
        
        .slider-row input.h-slider {
            background: linear-gradient(to right, 
                hsl(0,100%,50%), hsl(60,100%,50%), hsl(120,100%,50%), 
                hsl(180,100%,50%), hsl(240,100%,50%), hsl(300,100%,50%), hsl(360,100%,50%));
        }
        
        .slider-row input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 14px;
            height: 14px;
            background: #fff;
            border: 2px solid #000;
            border-radius: 50%;
            cursor: pointer;
        }
        
        .slider-row .slider-value {
            font-family: monospace;
            font-size: 10px;
            color: #888;
            width: 36px;
            text-align: right;
            background: transparent;
            border: 1px solid transparent;
            padding: 2px;
            -moz-appearance: textfield;
            appearance: textfield;
        }
        
        .slider-row .slider-value::-webkit-outer-spin-button,
        .slider-row .slider-value::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        
        .slider-row .slider-value:hover,
        .slider-row .slider-value:focus {
            border-color: #444;
            background: #222;
            outline: none;
            color: #fff;
        }
        
        #export-colors, #reset-colors, #import-colors {
            width: 100%;
            padding: 10px;
            margin-top: 6px;
            font-size: 12px;
            font-weight: 700;
            border: 3px solid #000;
            cursor: pointer;
        }
        
        #export-colors {
            background: #90EE90;
            color: #000;
        }
        
        #import-colors {
            background: #FFD966;
            color: #000;
        }
        
        #reset-colors {
            background: #FF6B6B;
            color: #000;
        }
    </style>
</head>

<body>
    <div class="page">
        <div class="page-header">
            <h1 class="header-title">BIT ÂêÉÈ•≠Âπ¥Â∫¶Êä•Âëä</h1>
        </div>

        <div class="layout">
            <!-- Â∑¶‰æßÔºöÂ§¥ÂÉè + ÊÄªËßà -->
            <aside class="sidebar">
                <div class="avatar-wrapper">
                    <div class="avatar">üçö</div>
                    <input id="avatar-input" type="file" accept="image/*" style="display: none;" />
                </div>

                <div class="profile-name">
                    <span id="user-title" contenteditable="true">[ÁÇπÂáªÁºñËæë]ÁöÑBITÂêÉÈ•≠ÊÄªÁªì</span>
                </div>

                <div id="summary-section">
                    <div id="summary-cards" class="summary-grid"></div>
                    <div id="summary-highlight" class="summary-highlight"></div>
                </div>
            </aside>

            <!-- Âè≥‰æßÔºöÊàêÂ∞± + È•≠ÂäõÂõæ -->
            <main class="main">
                <div id="achievements-section">
                    <div id="achievements-header">
                        <h2>ÊàêÂ∞±Â¢ô</h2>
                        <button id="view-all-achievements">Êü•ÁúãÂÖ®ÈÉ®ÊàêÂ∞±</button>
                    </div>
                    <div id="pinned-achievements" class="achievements-grid"></div>
                </div>

                <div id="year-switcher"></div>
                <div id="heatmap-container">
                    <div id="heatmap"></div>
                </div>
                <div id="day-detail"></div>
            </main>
        </div>

        <div id="achievements-modal" class="modal hidden">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>ÊâÄÊúâÊàêÂ∞±</h2>
                    <button id="close-achievements-modal">√ó</button>
                </div>
                <div class="modal-body" id="all-achievements-list"></div>
                <div class="modal-footer">
                    <span id="achievements-summary">Â∑≤Ëß£ÈîÅ 0/0</span>
                </div>
            </div>
        </div>
    </div>

    <!-- ÈÖçËâ≤Èù¢Êùø -->
    <button id="color-panel-toggle">üé® ÈÖçËâ≤</button>
    <div id="color-panel">
        <h3>üé® ÈÖçËâ≤Ë∞ÉËäÇÂô® (HSL)</h3>
        <div id="color-items-container"></div>
        <button id="export-colors">ÂØºÂá∫ÈÖçËâ≤ÊñπÊ°à</button>
        <button id="import-colors">‰ªéÈÖçËâ≤ÊñπÊ°àÊÅ¢Â§ç</button>
        <button id="reset-colors">ÈáçÁΩÆ‰∏∫ÈªòËÆ§</button>
    </div>

    <script>
        const EAT_DATA = {"2025": {"2025-01-25": {"count": 1, "amount": 3.1, "merchants": [{"name": "ËâØ‰π°‰∫åÈ£üÂ†Ç1212", "amount": 3.1}], "txs": [{"time": "06:06:47", "mername": "ËâØ‰π°‰∫åÈ£üÂ†Ç1212", "amount": 3.1}]}, "2025-01-24": {"count": 2, "amount": 4.82, "merchants": [{"name": "ËâØ‰π°‰∫åÈ£üÂ†Ç1212", "amount": 4.82}], "txs": [{"time": "07:29:47", "mername": "ËâØ‰π°‰∫åÈ£üÂ†Ç1212", "amount": 3.82}, {"time": "07:31:34", "mername": "ËâØ‰π°‰∫åÈ£üÂ†Ç1212", "amount": 1.0}]}, "2025-01-23": {"count": 9, "amount": 34.88, "merchants": [{"name": "ËâØ‰π°‰∫åÈ£üÂ†Ç1212", "amount": 27.38}, {"name": "ËâØ‰π°Á¨¨‰∫åÈ£üÂ†Ç‰∏ÄÂ±Ç", "amount": 5.0}, {"name": "ËâØ‰∫åÊ∞¥Âêß", "amount": 2.5}], "txs": [{"time": "11:07:33", "mername": "ËâØ‰π°‰∫åÈ£üÂ†Ç1212", "amount": 6.0}, {"time": "11:07:52", "mername": "ËâØ‰π°‰∫åÈ£üÂ†Ç1212", "amount": 0.44}, {"time": "11:08:20", "mername": "ËâØ‰π°‰∫åÈ£üÂ†Ç1212", "amount": 1.0}, {"time": "11:09:49", "mername": "ËâØ‰π°‰∫åÈ£üÂ†Ç1212", "amount": 6.0}, {"time": "11:22:39", "mername": "ËâØ‰∫åÊ∞¥Âêß", "amount": 2.5}, {"time": "16:40:41", "mername": "ËâØ‰π°‰∫åÈ£üÂ†Ç1212", "amount": 0.44}, {"time": "16:41:13", "mername": "ËâØ‰π°‰∫åÈ£üÂ†Ç1212", "amount": 1.5}, {"time": "16:42:23", "mername": "ËâØ‰π°Á¨¨‰∫åÈ£üÂ†Ç‰∏ÄÂ±Ç", "amount": 5.0}, {"time": "16:42:35", "mername": "ËâØ‰π°‰∫åÈ£üÂ†Ç1212", "amount": 12.0}]}, "2025-01-22": {"count": 6, "amount": 19.48, "merchants": [{"name": "ËâØ‰π°‰∫åÈ£üÂ†Ç1212", "amount": 19.48}], "txs": [{"time": "07:07:46", "mername": "ËâØ‰π°‰∫åÈ£üÂ†Ç1212", "amount": 2.32}, {"time": "07:09:28", "mername": "ËâØ‰π°‰∫åÈ£üÂ†Ç1212", "amount": 1.0}, {"time": "18:52:22", "mername": "ËâØ‰π°‰∫åÈ£üÂ†Ç1212", "amount": 14.0}, {"time": "18:57:20", "mername": "ËâØ‰π°‰∫åÈ£üÂ†Ç1212", "amount": 0.66}, {"time": "18:58:38", "mername": "ËâØ‰π°‰∫åÈ£üÂ†Ç1212", "amount": 0.5}, {"time": "19:10:21", "mername": "ËâØ‰π°‰∫åÈ£üÂ†Ç1212", "amount": 1.0}]}, "2025-01-21": {"count": 2, "amount": 14.66, "merchants": [{"name": "ËâØ‰π°‰∫åÈ£üÂ†Ç1212", "amount": 14.66}], "txs": [{"time": "11:31:27", "mername": "ËâØ‰π°‰∫åÈ£üÂ†Ç1212", "amount": 7.66}, {"time": "11:32:39", "mername": "ËâØ‰π°‰∫åÈ£üÂ†Ç1212", "amount": 7.0}]}}};
        const ACH_STATE = {"early_bird": {"unlocked": true, "unlocked_at": "2025-01-19 06:07", "extra": {"count": 5}}, "night_owl": {"unlocked": false, "unlocked_at": null, "extra": {"count": 2}}, "make_it_round": {"unlocked": false, "unlocked_at": null, "extra": {}}, "big_meal": {"unlocked": true, "unlocked_at": "2025-07-03 11:00", "extra": {"amount": 33.18}}, "minimalist": {"unlocked": true, "unlocked_at": "2025-01-04 12:00", "extra": {"amount": 0.38}}, "lost_kid": {"unlocked": false, "unlocked_at": null, "extra": {"days": 166}}, "eater": {"unlocked": true, "unlocked_at": "2025-01-02 06:57", "extra": {"days": 166}}, "hundred_days": {"unlocked": true, "unlocked_at": "2025-06-01 07:43", "extra": {"days": 166}}, "full_timer": {"unlocked": false, "unlocked_at": null, "extra": {"days": 166}}, "default_setting": {"unlocked": true, "unlocked_at": "2025-01-16 18:08", "extra": {"merchant": "ËâØÂõõÈ£üÂ†Ç1212", "count": 21}}, "story_start": {"unlocked": false, "unlocked_at": null, "extra": {}}, "another_year": {"unlocked": false, "unlocked_at": null, "extra": {}}, "missing_breakfast": {"unlocked": false, "unlocked_at": null, "extra": {"count": 228}}, "good_meals": {"unlocked": true, "unlocked_at": "2025-02-24 17:39", "extra": {"date": "2025-02-24"}}, "perfect_week": {"unlocked": false, "unlocked_at": null, "extra": {}}, "cosmic_meal": {"unlocked": false, "unlocked_at": null, "extra": {}}, "my_turn": {"unlocked": true, "unlocked_at": "2025-01-04 12:01", "extra": {"interval_seconds": 36.0}}, "edge_runner": {"unlocked": false, "unlocked_at": null, "extra": {}}, "error_404": {"unlocked": false, "unlocked_at": null, "extra": {}}, "hello_world": {"unlocked": true, "unlocked_at": "2025-01-02 06:57", "extra": {"first_date": "2025-01-02"}}, "pi": {"unlocked": false, "unlocked_at": null, "extra": {}}, "secure_call": {"unlocked": false, "unlocked_at": null, "extra": {}}, "noticed": {"unlocked": false, "unlocked_at": null, "extra": {"total_amount": 3189.6400000000012, "id_suffix": 1458}}};
    </script>
    <script>
        (function () {
    const yearSwitcher = document.getElementById("year-switcher");
    const heatmap = document.getElementById("heatmap");
    const detail = document.getElementById("day-detail");

    const IS_CLOUD = window.location.hostname === "eatbit.top";
    const HAS_PW_HASH = (window.location.hash || "").toLowerCase().includes("#pw=");

    const IS_EDIT_MODE = !IS_CLOUD || HAS_PW_HASH;
    const IS_SAVABLE = IS_CLOUD && HAS_PW_HASH;

    const years = Object.keys(EAT_DATA).sort();
    if (years.length === 0) {
        heatmap.textContent = "Ê≤°ÊúâÂèØÁî®Êï∞ÊçÆ";
        return;
    }

    let currentYear = years[years.length - 1];

    function buildYearButtons() {
        yearSwitcher.innerHTML = "";
        years.forEach((year) => {
            const btn = document.createElement("button");
            btn.textContent = year;
            btn.className = "year-button" + (year === currentYear ? " active" : "");
            btn.onclick = () => {
                currentYear = year;
                buildYearButtons();
                renderYear(year);
            };
            yearSwitcher.appendChild(btn);
        });
    }

    function getDateRangeForYear(year) {
        const start = new Date(Number(year), 0, 1);
        const end = new Date(Number(year), 11, 31);
        return { start, end };
    }

    function buildDailyArrayForYear(year) {
        const stats = EAT_DATA[year] || {};
        const { start, end } = getDateRangeForYear(year);
        const days = [];
        const firstDayOfWeek = (start.getDay() + 6) % 7;
        let index = 0;

        for (let d = new Date(start); d <= end; d.setDate(d.getDate() + 1), index++) {
            const yyyy = d.getFullYear();
            const mm = String(d.getMonth() + 1).padStart(2, "0");
            const dd = String(d.getDate()).padStart(2, "0");
            const key = `${yyyy}-${mm}-${dd}`;
            const dayStats = stats[key] || { count: 0, amount: 0, merchants: [] };

            const weekday = (d.getDay() + 6) % 7;
            const weekIndex = Math.floor((index + firstDayOfWeek) / 7);

            days.push({ date: key, weekday, weekIndex, ...dayStats });
        }
        return days;
    }

    function renderSummaryFromDays(year, days) {
        const cards = document.getElementById("summary-cards");
        const highlight = document.getElementById("summary-highlight");
        if (!cards || !highlight) return;

        let eatDays = 0;
        let totalCount = 0;
        let totalAmount = 0;
        let maxDay = null;
        let maxStreak = 0;
        let currentStreak = 0;

        days.forEach((d) => {
            const count = d.count || 0;
            const amount = typeof d.amount === "number" ? d.amount : Number(d.amount || 0);

            if (count > 0) {
                eatDays += 1;
                currentStreak += 1;
                if (currentStreak > maxStreak) {
                    maxStreak = currentStreak;
                }
            } else {
                currentStreak = 0;
            }

            totalCount += count;
            totalAmount += amount;

            if (count > 0) {
                if (!maxDay || count > maxDay.count || (count === maxDay.count && amount > maxDay.amount)) {
                    maxDay = { date: d.date, count, amount };
                }
            }
        });

        const avgPerMeal = totalCount > 0 ? totalAmount / totalCount : 0;

        cards.innerHTML = "";

        function addCard(label, value) {
            const card = document.createElement("div");
            card.className = "summary-card";

            const labelEl = document.createElement("div");
            labelEl.className = "summary-card-label";
            labelEl.textContent = label;

            const valueEl = document.createElement("div");
            valueEl.className = "summary-card-value";
            valueEl.textContent = value;

            card.appendChild(labelEl);
            card.appendChild(valueEl);
            cards.appendChild(card);
        }

        addCard("ÂÖ®Âπ¥Â∞±È§êÂ§©Êï∞", `${eatDays} Â§©`);
        addCard("ÊÄªÁî®È§êÊ¨°Êï∞", `${totalCount} Ê¨°`);
        addCard("ÊÄªÊ∂àË¥πÈáëÈ¢ù", `${totalAmount.toFixed(2)} ÂÖÉ`);
        addCard("Âπ≥ÂùáÊØèÈ§êÊ∂àË¥π", totalCount > 0 ? `${avgPerMeal.toFixed(2)} ÂÖÉ` : "‚Äî");

        if (!maxDay) {
            highlight.textContent = `${year} Âπ¥Âú®È£üÂ†ÇÊ≤°ÊúâÊ∂àË¥πËÆ∞ÂΩï„ÄÇ`;
        } else {
            highlight.textContent = `ÂêÉÂæóÊúÄÂ§öÁöÑ‰∏ÄÂ§©ÊòØ ${maxDay.date}ÔºöÂÖ± ${maxDay.count} Ê¨°ÔºåÊ∂àË¥π ${maxDay.amount.toFixed(2)} ÂÖÉÔºõÊúÄÈïøËøûÁª≠ÂêÉÈ•≠Â§©Êï∞‰∏∫ ${maxStreak} Â§©„ÄÇ`;
        }
    }

    function countWeeks(days) {
        if (days.length === 0) return 0;
        return days[days.length - 1].weekIndex + 1;
    }

    function computeMaxCount(days) {
        let max = 0;
        days.forEach((d) => {
            if (d.count > max) max = d.count;
        });
        return max;
    }

    function levelForCount(count, max) {
        if (count === 0) return 0;
        if (max <= 1) return 2;
        const ratio = count / max;
        if (ratio <= 0.25) return 1;
        if (ratio <= 0.5) return 2;
        if (ratio <= 0.75) return 3;
        return 4;
    }

    function renderYear(year) {
        const days = buildDailyArrayForYear(year);
        renderSummaryFromDays(year, days);
        const weekCount = countWeeks(days);
        const maxCount = computeMaxCount(days);

        heatmap.innerHTML = "";

        const scroll = document.createElement("div");
        scroll.className = "heatmap-scroll";

        const container = document.createElement("div");
        container.style.display = "flex";

        const weekdayLabels = document.createElement("div");
        weekdayLabels.className = "weekday-labels";
        const weekdayTexts = ["‰∏Ä", "‰∏â", "‰∫î", "‰∏É"];
        const weekdayRows = [1, 3, 5, 7];
        weekdayTexts.forEach((label, idx) => {
            const div = document.createElement("div");
            div.textContent = label;
            div.style.gridRowStart = weekdayRows[idx];
            weekdayLabels.appendChild(div);
        });

        const main = document.createElement("div");

        const monthLabels = document.createElement("div");
        monthLabels.className = "month-labels";
        let lastMonth = null;
        for (let w = 0; w < weekCount; w++) {
            const monthDiv = document.createElement("div");
            const weekDay = days.find((d) => d.weekIndex === w);
            if (weekDay) {
                const dObj = new Date(weekDay.date);
                const month = dObj.getMonth() + 1;
                if (month !== lastMonth) {
                    monthDiv.textContent = month + "Êúà";
                    lastMonth = month;
                }
            }
            monthLabels.appendChild(monthDiv);
        }

        const grid = document.createElement("div");
        grid.className = "heatmap-grid";

        days.forEach((day) => {
            const cell = document.createElement("div");
            const weekday = day.weekday;
            const weekIndex = day.weekIndex;

            cell.className = "day-cell";
            cell.dataset.date = day.date;
            const level = levelForCount(day.count, maxCount);
            cell.classList.add(`level-${level}`);

            cell.style.gridRowStart = weekday + 1;
            cell.style.gridColumnStart = weekIndex + 1;

            cell.title = `${day.date}Ôºö${day.count} Ê¨°Áî®È§ê`;
            cell.onclick = () => showDayDetail(year, day);

            grid.appendChild(cell);
        });

        main.appendChild(monthLabels);
        main.appendChild(grid);

        container.appendChild(weekdayLabels);
        container.appendChild(main);

        scroll.appendChild(container);
        heatmap.appendChild(scroll);
    }

    function showDayDetail(year, day) {
        detail.innerHTML = "";
        if (!day || !day.count) {
            return;
        }
        const h2 = document.createElement("h2");
        h2.textContent = day.date;
        detail.appendChild(h2);

        const p1 = document.createElement("p");
        p1.textContent = `ÂΩìÂ§©Âú®È£üÂ†ÇÂêÉ‰∫Ü ${day.count} Ê¨°ÔºåÂÖ±Ê∂àË¥π ${day.amount.toFixed(2)} ÂÖÉ„ÄÇ`;
        detail.appendChild(p1);

        if (day.txs && day.txs.length > 0) {
            const ul = document.createElement("ul");
            day.txs.forEach((tx) => {
                const li = document.createElement("li");
                const time = tx.time || "";
                const mer = tx.mername || tx.name || "";
                const amtNum = typeof tx.amount === "number" ? tx.amount : Number(tx.amount || 0);
                li.textContent = `${time} ${mer}Ôºö${amtNum.toFixed(2)} ÂÖÉ`;
                ul.appendChild(li);
            });
            detail.appendChild(ul);
        } else if (day.merchants && day.merchants.length > 0) {
            const ul = document.createElement("ul");
            day.merchants.slice(0, 5).forEach((m) => {
                const li = document.createElement("li");
                li.textContent = `${m.name}Ôºö${m.amount.toFixed(2)} ÂÖÉ`;
                ul.appendChild(li);
            });
            detail.appendChild(ul);
        }
    }

    function setupAvatarUpload() {
        const avatar = document.querySelector(".avatar");
        const fileInput = document.getElementById("avatar-input");
        if (!avatar || !fileInput) {
            return;
        }

        if (!IS_EDIT_MODE) {
            avatar.style.cursor = "default";
            return;
        }

        avatar.style.cursor = "pointer";

        avatar.addEventListener("click", () => {
            fileInput.click();
        });

        fileInput.addEventListener("change", () => {
            const files = fileInput.files;
            if (!files || files.length === 0) {
                return;
            }
            const file = files[0];
            if (!file.type || !file.type.startsWith("image/")) {
                alert("ËØ∑ÈÄâÊã©ÂõæÁâáÊñá‰ª∂‰Ωú‰∏∫Â§¥ÂÉè");
                fileInput.value = "";
                return;
            }
            const reader = new FileReader();
            reader.onload = (e) => {
                const result = e.target && e.target.result;
                if (!result) return;
                avatar.style.backgroundImage = `url(${result})`;
                avatar.style.backgroundSize = "cover";
                avatar.style.backgroundPosition = "center";
                avatar.textContent = "";
            };
            reader.readAsDataURL(file);
        });
    }

    const ACH_META = {
        early_bird: { title: "Êó©ÂÖ´‰∫∫", desc: "‰Ω†ËßÅËøáÊó©‰∏äÂÖ´ÁÇπÁöÑÁôæ‰∏ΩÂÆ´Âêó", rarity: 3, condition: "06:00-08:00Èó¥Ê∂àË¥πËøá5Ê¨°", emoji: "‚è∞" },
        night_owl: { title: "ÂÆàÂ§ú‰∫∫", desc: "ÊçÆËØ¥Âè™Ë¶Å‰∏çËÆ°ÁÆóÊôö‰∏äÁöÑÂç°Ë∑ØÈáåÔºåÂÆÉ‰ª¨Â∞±‰∏çÂ≠òÂú®", rarity: 3, condition: "21:00‰ª•ÂêéÊ∂àË¥πËøá5Ê¨°", emoji: "üåô" },
        make_it_round: { title: "ÂáëÂçïÈ¢ÜÂüüÂ§ßÁ•û", desc: "Â≠¶Ê†°‰πüÊúâÊª°ÂáèÂêó", rarity: 3, condition: "ÂçïÊó•Ê∂àË¥πÊÄªÈáëÈ¢ù‰∏çÂ∞è‰∫é20‰∏î‰∏∫10ÁöÑÂÄçÊï∞", emoji: "‚öñÔ∏è" },
        big_meal: { title: "Âä†‰∏™È∏°ËÖø", desc: "ÂêÉÁÇπÂ•ΩÁöÑÔºÅ", rarity: 2, condition: "ÂçïÁ¨îÊ∂àË¥πÈáëÈ¢ùÂ§ß‰∫é25ÂÖÉ", emoji: "üçó" },
        minimalist: { title: "ÊûÅÈôêÁîüÂ≠ò", desc: "ÊûÅÁÆÄ‰∏ª‰πâÈ•ÆÈ£üË∑µË°åËÄÖ", rarity: 3, condition: "ÂçïÁ¨îÊ∂àË¥πÈáëÈ¢ùÂ∞è‰∫é1ÂÖÉ", emoji: "ü•õ" },
        lost_kid: { title: "Ëø∑ÈÄî‰πãÂ≠ê", desc: "‰Ω†Ëø∑Ë∑Ø‰∫ÜÂêó", rarity: 4, condition: "ÂÖ®Âπ¥Â∞±È§êÂ§©Êï∞Â∞è‰∫é50Â§©", emoji: "‚ùî" },
        eater: { title: "Âπ≤È•≠‰∫∫", desc: "Ëá≥Â∞ë‰Ω†ÊâæÂà∞‰∫ÜÈ£üÂ†Ç", rarity: 1, condition: "ÂÖ®Âπ¥Â∞±È§êÂ§©Êï∞Â§ß‰∫éÁ≠â‰∫é1Â§©", emoji: "üçΩÔ∏è" },
        hundred_days: { title: "ÁôæÊó•ÁÉüÁÅ´", desc: "È£üÂ†ÇÈòøÂß®ÂèØËÉΩÈÉΩËÆ§ËØÜ‰Ω†‰∫Ü", rarity: 2, condition: "ÂÖ®Âπ¥Â∞±È§êÂ§©Êï∞Â§ß‰∫éÁ≠â‰∫é100Â§©", emoji: "üç≤" },
        full_timer: { title: "ÂÖ®Âã§Â•ñ", desc: "‰∏ÄÁû¨‰∏ÄÁû¨Á¥ØÁßØËµ∑Êù•Â∞±‰ºöÂèòÊàê‰∏ÄËæàÂ≠ê", rarity: 3, condition: "ÂÖ®Âπ¥Â∞±È§êÂ§©Êï∞Â§ß‰∫éÁ≠â‰∫é200Â§©", emoji: "üèÖ" },
        default_setting: { title: "Ë•øË•øÂºóÊñØ", desc: "Êàë‰ª¨ÂøÖÈ°ªÊÉ≥Ë±°‰Ω†ÊòØÂπ∏Á¶èÁöÑ", rarity: 2, condition: "Âú®Âêå‰∏Ä‰∏™ÂïÜÂÆ∂Ê∂àË¥πÊ¨°Êï∞Â§ß‰∫é20Ê¨°", emoji: "üîÅ" },
        story_start: { title: "ÊïÖ‰∫ãÁöÑÂºÄÂßã", desc: "ÂÖ∂ÂÆûÂë≥ÈÅìÂíåÂéªÂπ¥Ê≤°Âå∫Âà´", rarity: 4, condition: "Âú®Êú¨Âπ¥Á¨¨‰∏ÄÂ§©ÂêÉÈ•≠", emoji: "üìÖ" },
        another_year: { title: "Âèà‰∏ÄÂπ¥", desc: "ÊòéÂπ¥ËßÅ", rarity: 4, condition: "Âú®Êú¨Âπ¥ÊúÄÂêé‰∏ÄÂ§©ÂêÉÈ•≠", emoji: "üëã" },
        missing_breakfast: { title: "Ê∂àÂ§±ÁöÑÊó©È§ê", desc: "ÈÇ£‰∫õ‰ªéÊù•‰∏çÂêÉÊó©È•≠ÁöÑ‰∫∫ÔºåÁé∞Âú®ÈÉΩÊÄé‰πàÊ†∑‰∫ÜÔºü", rarity: 3, condition: "9ÁÇπÂâçÊ∂àË¥πÊ¨°Êï∞Â∞è‰∫é10Ê¨°", emoji: "üëª" },
        good_meals: { title: "Â•ΩÂ•ΩÂêÉÈ•≠", desc: "‰Ω†Êã•Êúâ‰ª§‰∫∫Áæ°ÊÖïÁöÑÂÅ•Â∫∑‰ΩúÊÅØ", rarity: 3, condition: "ÂçïÊó•ÂÜÖÂêåÊó∂ÊúâÊó©„ÄÅ‰∏≠„ÄÅÊôö‰∏âÈ§êËÆ∞ÂΩï", emoji: "ü•ó" },
        my_turn: { title: "ÊàëÁöÑÂõûÂêà", desc: "ÊàëÁöÑÂõûÂêà‰πãÂêé‚Äî‚ÄîËøòÊòØÊàëÁöÑÂõûÂêàÔºÅ", rarity: 3, condition: "2ÂàÜÈíüÂÜÖËøûÁª≠Âà∑Âç°2Ê¨°", emoji: "üÉè" },
        error_404: { title: "Error 404", desc: "404 Not Found", rarity: 3, condition: "ÂçïÁ¨îÊ∂àË¥πÈáëÈ¢ùÊÅ∞‰∏∫4.04/40.4/404ÂÖÉ", emoji: "‚ùå" },
        hello_world: { title: "Hello World", desc: "‰Ω†Â•ΩÔºåÈ£üÂ†ÇÔºÅ", rarity: 1, condition: "Âú®‰ªäÂπ¥ËøõË°åËøáÊ∂àË¥π", emoji: "üëã" },
        pi: { title: "PI", desc: "ÂúÜÈ£üÔºåÂêØÂä®ÔºÅ", rarity: 3, condition: "ÂçïÁ¨îÊ∂àË¥πÈáëÈ¢ùÊÅ∞‰∏∫3.14/31.4/314ÂÖÉ", emoji: "ü•ß" },
        secure_call: { title: "Âä†ÂØÜÈÄöËØù", desc: "‰Ω†ÁöÑË¥¶Êà∑ÂÆâÂÖ®Á≥ªÊï∞ÂáªË¥•‰∫Ü99ÔºÖÁöÑÂêåÂ≠¶", rarity: 3, condition: "ÂØÜÁ†Å‰∏çÊòØÈªòËÆ§ÂÄº 123456", emoji: "üîê" },
        noticed: { title: "Ê≥®ÊÑèÂà∞", desc: "Ê≥®ÊÑèÂäõÊÉä‰∫∫", rarity: 4, condition: "ÂÖ®Âπ¥Ê∂àË¥πÊÄªÈáëÈ¢ùÊÅ∞‰∏∫Â≠¶Âè∑ÂêéÂõõ‰ΩçÁöÑÂÄçÊï∞", emoji: "üßê" },
        perfect_week: { title: "ÂÆåÁæé‰∏ÄÂë®", desc: "ÂåªÁîüÁúã‰∫ÜÈÉΩËØ¥Â•Ω", rarity: 3, condition: "ËøûÁª≠‰∏ÉÂ§©‰∏ÄÊó•‰∏âÈ§ê", emoji: "üë®‚Äç‚öï" },
        cosmic_meal: { title: "ÂÆáÂÆôÈ•≠", desc: "Â¶ÇÊûú‰Ω†ÁöÑÂïÜÂÆ∂ÈáåÊ≤°ÊúâÁõ∏ÂêåÁöÑÂïÜÂÆ∂ÔºåËé∑ÂæóÊú¨ÊàêÂ∞±", rarity: 3, condition: "ËøûÁª≠‰∫îÂ§©ÊØèÂ§©Âú®‰∏ç‰∏ÄÊ†∑ÁöÑÂïÜÂÆ∂ÂêÉÈ•≠", emoji: "üåå" },
        edge_runner: { title: "ËæπÁºòË°åËÄÖ", desc: "Áôæ‰∏ΩÂÆ´ÊúâÊ¥ªÁùÄÁöÑ‰º†Â•á", rarity: 4, condition: "Âú®‰ªªÊÑèÂ∞èÊó∂ÁöÑÁ¨¨59ÂàÜ59ÁßíÂÆåÊàê‰∫§Êòì", emoji: "‚ö°" },
    };

    const MAX_PINS = 6;

    function loadInitialPinnedIds() {
        const body = document.body;
        if (!body || !body.dataset) return [];
        const raw = body.dataset.pinnedIds;
        if (!raw) return [];
        return raw.split(",").map((s) => s.trim()).filter((s) => s.length > 0);
    }

    let pinnedIdsState = loadInitialPinnedIds();

    function isHiddenAchievement(a) {
        return a && a.rarity === 4;
    }

    function buildMergedAchievements() {
        const merged = [];
        const state = typeof ACH_STATE === "object" ? ACH_STATE : {};
        for (const [id, meta] of Object.entries(ACH_META)) {
            const st = state[id] || { unlocked: false, unlocked_at: null, extra: {} };
            merged.push({ id, ...meta, ...st });
        }
        return merged;
    }

    function updateAchievementsSummary(allAchievements) {
        const el = document.getElementById("achievements-summary");
        if (!el) return;
        const base = allAchievements.filter((a) => !isHiddenAchievement(a));
        const total = base.length;
        const unlocked = allAchievements.filter((a) => a.unlocked).length;
        const hiddenUnlocked = allAchievements.filter((a) => isHiddenAchievement(a) && a.unlocked).length;

        el.innerHTML = "";
        const baseText = document.createTextNode(`Â∑≤Ëß£ÈîÅ ${unlocked}/${total}`);
        el.appendChild(baseText);

        if (hiddenUnlocked > 0) {
            const hint = document.createElement("span");
            hint.className = "hidden-achievements-hint";
            hint.textContent = `ÔºàÂåÖÂê´ ${hiddenUnlocked} ‰∏™ÈöêËóèÊàêÂ∞±ÔºÅÔºâ`;
            el.appendChild(hint);
        }
    }

    function loadPinnedIds(allAchievements) {
        const validIds = new Set(allAchievements.map((a) => a.id));
        return pinnedIdsState.filter((id) => validIds.has(id));
    }

    function savePinnedIds(ids) {
        pinnedIdsState = [...ids];
        const body = document.body;
        if (body && body.dataset) {
            body.dataset.pinnedIds = ids.join(",");
        }
    }

    function renderPinnedAchievements(allAchievements) {
        const container = document.getElementById("pinned-achievements");
        if (!container) return;
        container.innerHTML = "";

        const pinnedIds = loadPinnedIds(allAchievements);
        let pinned;
        if (pinnedIds.length === 0) {
            pinned = allAchievements.filter((a) => a.unlocked).sort((a, b) => b.rarity - a.rarity).slice(0, MAX_PINS);
            savePinnedIds(pinned.map((a) => a.id));
        } else {
            const map = new Map(allAchievements.map((a) => [a.id, a]));
            pinned = pinnedIds.map((id) => map.get(id)).filter((a) => a && a.unlocked);
        }

        pinned = pinned.filter((a) => a && a.unlocked);

        if (pinned.length === 0) {
            const empty = document.createElement("div");
            empty.className = "achievement-desc";
            empty.textContent = "ÂΩìÂâçËøòÊ≤°ÊúâÂ∑≤Ëß£ÈîÅÁöÑÊàêÂ∞±";
            container.appendChild(empty);
            return;
        }

        pinned.forEach((a) => {
            const card = document.createElement("div");
            card.className = "achievement-card";

            const icon = document.createElement("div");
            icon.className = "achievement-icon";
            if (a.emoji) {
                icon.textContent = a.emoji;
            }

            const text = document.createElement("div");
            text.className = "achievement-text";

            const titleEl = document.createElement("div");
            titleEl.className = "achievement-title";
            titleEl.textContent = a.title;

            const descEl = document.createElement("div");
            descEl.className = "achievement-desc";
            descEl.textContent = a.condition || a.desc || "";

            text.appendChild(titleEl);
            text.appendChild(descEl);

            card.appendChild(icon);
            card.appendChild(text);

            const timeEl = document.createElement("div");
            timeEl.className = "achievement-time";
            timeEl.textContent = a.unlocked_at || "";

            card.appendChild(timeEl);

            container.appendChild(card);
        });
    }

    function renderAllAchievementsModal(allAchievements) {
        const listEl = document.getElementById("all-achievements-list");
        if (!listEl) return;
        listEl.innerHTML = "";

        const pinnedIds = new Set(loadPinnedIds(allAchievements));

        const visible = allAchievements.filter((a) => !(isHiddenAchievement(a) && !a.unlocked));

        const sorted = visible.map((a, index) => ({
            data: a,
            index,
            isPinned: pinnedIds.has(a.id),
            isUnlocked: !!a.unlocked,
        })).sort((x, y) => {
            if (x.isPinned !== y.isPinned) {
                return x.isPinned ? -1 : 1;
            }
            if (x.isUnlocked !== y.isUnlocked) {
                return x.isUnlocked ? -1 : 1;
            }
            return x.index - y.index;
        });

        sorted.forEach((wrapper) => {
            const a = wrapper.data;

            const row = document.createElement("div");
            row.className = "all-achievement-row";

            const checkbox = document.createElement("input");
            checkbox.type = "checkbox";
            checkbox.className = "pin-checkbox";
            checkbox.checked = pinnedIds.has(a.id);

            const icon = document.createElement("div");
            icon.className = "achievement-icon";
            if (a.emoji) {
                icon.textContent = a.emoji;
            }

            const info = document.createElement("div");
            info.className = "all-achievement-info";

            const meta = document.createElement("div");
            meta.className = "all-achievement-meta";

            const titleEl = document.createElement("div");
            titleEl.className = "achievement-title";
            titleEl.textContent = a.title;

            const descEl = document.createElement("div");
            descEl.className = "achievement-desc";
            descEl.textContent = a.desc;

            meta.appendChild(titleEl);

            if (a.condition) {
                const condEl = document.createElement("div");
                condEl.className = "achievement-desc";
                condEl.textContent = a.condition;
                meta.appendChild(condEl);
            }

            meta.appendChild(descEl);

            info.appendChild(meta);

            const timeEl = document.createElement("div");
            timeEl.className = "all-achievement-unlock-time";
            timeEl.textContent = a.unlocked_at ? a.unlocked_at : "Êú™Ëß£ÈîÅ";

            row.appendChild(checkbox);
            row.appendChild(icon);
            row.appendChild(info);
            row.appendChild(timeEl);

            if (!a.unlocked) {
                checkbox.disabled = true;
                row.classList.add("locked");
            } else if (!IS_EDIT_MODE) {
                checkbox.disabled = true;
            } else {
                const applyPinState = (nextChecked) => {
                    const current = new Set(loadPinnedIds(allAchievements));
                    if (nextChecked) {
                        if (current.size >= MAX_PINS && !current.has(a.id)) {
                            alert(`ÊúÄÂ§öÂè™ËÉΩÂõ∫ÂÆö ${MAX_PINS} ‰∏™ÊàêÂ∞±`);
                            checkbox.checked = false;
                            return;
                        }
                        current.add(a.id);
                    } else {
                        current.delete(a.id);
                    }
                    const arr = Array.from(current);
                    savePinnedIds(arr);
                    renderPinnedAchievements(allAchievements);
                };

                checkbox.onchange = () => {
                    applyPinState(checkbox.checked);
                };

                row.onclick = (e) => {
                    if (e.target === checkbox) return;
                    const nextChecked = !checkbox.checked;
                    checkbox.checked = nextChecked;
                    applyPinState(nextChecked);
                };
            }

            listEl.appendChild(row);
        });
    }

    function setupSaveButton() {
        const existing = document.getElementById("save-to-link");

        if (!IS_SAVABLE) {
            if (existing && existing.parentNode) {
                existing.parentNode.removeChild(existing);
            }
            return;
        }

        const header = document.querySelector(".page-header");
        if (!header) return;

        const btn = existing || document.createElement("button");
        if (!existing) {
            btn.id = "save-to-link";
            btn.textContent = "‰øùÂ≠ò";
            header.appendChild(btn);
        }

        btn.onclick = async () => {
            const originalText = btn.textContent || "‰øùÂ≠ò";
            btn.disabled = true;
            btn.textContent = "‰øùÂ≠ò‰∏≠...";

            const path = window.location.pathname || "";
            const parts = path.split("/").filter(Boolean);
            if (parts.length < 2 || parts[0] !== "r") {
                alert("Êó†Ê≥ïËß£ÊûêÊä•Âëä IDÔºå‰øùÂ≠òÂ§±Ë¥•„ÄÇ");
                btn.disabled = false;
                btn.textContent = originalText;
                return;
            }
            const currentId = parts[1];
            const html = "<!DOCTYPE html>\n" + document.documentElement.outerHTML;

            try {
                const resp = await fetch(`/api/reports/${encodeURIComponent(currentId)}`, {
                    method: "PUT",
                    headers: { "Content-Type": "text/html" },
                    body: html,
                });
                if (resp.ok) {
                    btn.textContent = "Â∑≤‰øùÂ≠ò";
                    setTimeout(() => {
                        btn.disabled = false;
                        btn.textContent = originalText;
                    }, 1500);
                } else {
                    alert(`‰øùÂ≠òÂ§±Ë¥•ÔºöHTTP ${resp.status}`);
                    btn.disabled = false;
                    btn.textContent = originalText;
                }
            } catch (e) {
                alert("‰øùÂ≠òÂ§±Ë¥•ÔºåËØ∑Ê£ÄÊü•ÁΩëÁªúËøûÊé•„ÄÇ");
                btn.disabled = false;
                btn.textContent = originalText;
            }
        };
    }

    function setupAchievementsUI() {
        const allAchievements = buildMergedAchievements();

        const userTitle = document.getElementById("user-title");
        if (userTitle) {
            userTitle.contentEditable = IS_EDIT_MODE ? "true" : "false";
        }
        renderPinnedAchievements(allAchievements);
        updateAchievementsSummary(allAchievements);

        setupSaveButton();

        const modal = document.getElementById("achievements-modal");
        const openBtn = document.getElementById("view-all-achievements");
        const closeBtn = document.getElementById("close-achievements-modal");

        if (openBtn && modal) {
            openBtn.onclick = () => {
                renderAllAchievementsModal(allAchievements);
                modal.classList.remove("hidden");
            };
        }

        if (closeBtn && modal) {
            closeBtn.onclick = () => {
                modal.classList.add("hidden");
            };
        }

        if (modal) {
            modal.addEventListener("click", (e) => {
                if (e.target === modal) {
                    modal.classList.add("hidden");
                }
            });
        }
    }

    function setupAvatarUpload() {
        // Add your avatar upload logic here
    }

    buildYearButtons();
    renderYear(currentYear);
    setupAchievementsUI();
    setupAvatarUpload();
})();
    </script>
    
    <!-- ÈÖçËâ≤Èù¢ÊùøËÑöÊú¨ (HSLÊªëÂùó) -->
    <script>
    (function() {
        const colorConfig = [
            { group: 'È°µÈù¢', items: [
                { var: '--bg-page', label: 'ËÉåÊôØËâ≤', default: '#F7F2C4' }
            ]},
            { group: '‰∏ªË¶ÅÊ®°Âùó', items: [
                { var: '--color-header', label: 'È°µÂ§¥', default: '#34C759' },
                { var: '--color-avatar-wrapper', label: 'Â§¥ÂÉèÂå∫', default: '#FF69B4' },
                { var: '--color-avatar', label: 'Â§¥ÂÉè', default: '#FFDB58' },
                { var: '--color-achievements', label: 'ÊàêÂ∞±Âå∫', default: '#A388EE' },
                { var: '--color-button', label: 'ÊåâÈíÆ', default: '#FFDB58' },
                { var: '--color-icon', label: 'ÊàêÂ∞±ÂõæÊ†á', default: '#FFA07A' },
                { var: '--color-day-detail', label: 'Êó•ÊúüËØ¶ÊÉÖ', default: '#FDFD96' }
            ]},
            { group: 'ÁªüËÆ°Âç°Áâá', items: [
                { var: '--color-card1', label: 'Âç°Áâá1', default: '#FFA07A' },
                { var: '--color-card2', label: 'Âç°Áâá2', default: '#7DF9FF' },
                { var: '--color-card3', label: 'Âç°Áâá3', default: '#90EE90' },
                { var: '--color-card4', label: 'Âç°Áâá4', default: '#FF6B6B' }
            ]},
            { group: 'ÁÉ≠ÂäõÂõæËâ≤Èò∂', items: [
                { var: '--heatmap-0', label: 'Level 0', default: '#f5f5f5' },
                { var: '--heatmap-1', label: 'Level 1', default: '#FFA07A' },
                { var: '--heatmap-2', label: 'Level 2', default: '#FF7A5C' },
                { var: '--heatmap-3', label: 'Level 3', default: '#FF6B6B' },
                { var: '--heatmap-4', label: 'Level 4', default: '#FF4911' }
            ]}
        ];

        const CACHE_KEY = 'neo_brutalism_colors';

        // ÁºìÂ≠òËØªÂÜô
        function loadCache() {
            try {
                return JSON.parse(localStorage.getItem(CACHE_KEY)) || {};
            } catch { return {}; }
        }

        function saveCache(colors) {
            try {
                localStorage.setItem(CACHE_KEY, JSON.stringify(colors));
            } catch {}
        }

        function clearCache() {
            try {
                localStorage.removeItem(CACHE_KEY);
            } catch {}
        }

        const cachedColors = loadCache();

        // HEX <-> HSL ËΩ¨Êç¢
        function hexToHsl(hex) {
            let r = parseInt(hex.slice(1,3), 16) / 255;
            let g = parseInt(hex.slice(3,5), 16) / 255;
            let b = parseInt(hex.slice(5,7), 16) / 255;
            let max = Math.max(r,g,b), min = Math.min(r,g,b);
            let h, s, l = (max + min) / 2;
            if (max === min) { h = s = 0; }
            else {
                let d = max - min;
                s = l > 0.5 ? d / (2 - max - min) : d / (max + min);
                switch(max) {
                    case r: h = ((g - b) / d + (g < b ? 6 : 0)) / 6; break;
                    case g: h = ((b - r) / d + 2) / 6; break;
                    case b: h = ((r - g) / d + 4) / 6; break;
                }
            }
            return { h: Math.round(h * 360), s: Math.round(s * 100), l: Math.round(l * 100) };
        }

        function hslToHex(h, s, l) {
            s /= 100; l /= 100;
            const a = s * Math.min(l, 1 - l);
            const f = n => {
                const k = (n + h / 30) % 12;
                const color = l - a * Math.max(Math.min(k - 3, 9 - k, 1), -1);
                return Math.round(255 * color).toString(16).padStart(2, '0');
            };
            return `#${f(0)}${f(8)}${f(4)}`.toUpperCase();
        }

        const container = document.getElementById('color-items-container');
        const colorItems = [];

        // ÁîüÊàê UI
        colorConfig.forEach(group => {
            const groupDiv = document.createElement('div');
            groupDiv.className = 'color-group';
            groupDiv.innerHTML = `<div class="color-group-title">${group.group}</div>`;

            group.items.forEach(item => {
                // ‰ºòÂÖà‰ΩøÁî®ÁºìÂ≠òÈ¢úËâ≤
                const hex = cachedColors[item.var] || getComputedStyle(document.documentElement).getPropertyValue(item.var).trim() || item.default;
                document.documentElement.style.setProperty(item.var, hex);
                const hsl = hexToHsl(hex);

                const div = document.createElement('div');
                div.className = 'color-item';
                div.innerHTML = `
                    <div class="color-item-header">
                        <label>${item.label}</label>
                        <div class="color-preview" style="background:${hex}"></div>
                        <input type="text" class="hex" value="${hex}" maxlength="7">
                    </div>
                    <div class="hsl-sliders">
                        <div class="slider-row">
                            <span>H</span>
                            <input type="range" class="h-slider" min="0" max="360" value="${hsl.h}">
                            <input type="number" class="slider-value" value="${hsl.h}" min="0" max="360">
                        </div>
                        <div class="slider-row">
                            <span>S</span>
                            <input type="range" class="s-slider" min="0" max="100" value="${hsl.s}">
                            <input type="number" class="slider-value" value="${hsl.s}" min="0" max="100">
                        </div>
                        <div class="slider-row">
                            <span>L</span>
                            <input type="range" class="l-slider" min="0" max="100" value="${hsl.l}">
                            <input type="number" class="slider-value" value="${hsl.l}" min="0" max="100">
                        </div>
                    </div>
                `;

                const hSlider = div.querySelector('.h-slider');
                const sSlider = div.querySelector('.s-slider');
                const lSlider = div.querySelector('.l-slider');
                const preview = div.querySelector('.color-preview');
                const hexInput = div.querySelector('.hex');
                const values = div.querySelectorAll('.slider-value');

                // Êõ¥Êñ∞ÊªëÂùóÊ∏êÂèòËÉåÊôØ
                const updateSliderGradients = (h, s, l) => {
                    sSlider.style.background = `linear-gradient(to right, hsl(${h},0%,${l}%), hsl(${h},100%,${l}%))`;
                    lSlider.style.background = `linear-gradient(to right, hsl(${h},${s}%,0%), hsl(${h},${s}%,50%), hsl(${h},${s}%,100%))`;
                };

                // ‰øùÂ≠òÂà∞ÁºìÂ≠ò
                const persistToCache = (hexVal) => {
                    cachedColors[item.var] = hexVal;
                    saveCache(cachedColors);
                };

                // ‰ªéÊªëÂùóÊõ¥Êñ∞È¢úËâ≤
                const updateFromSliders = () => {
                    const h = +hSlider.value, s = +sSlider.value, l = +lSlider.value;
                    const newHex = hslToHex(h, s, l);
                    document.documentElement.style.setProperty(item.var, newHex);
                    preview.style.background = newHex;
                    hexInput.value = newHex;
                    values[0].value = h;
                    values[1].value = s;
                    values[2].value = l;
                    updateSliderGradients(h, s, l);
                    persistToCache(newHex);
                };

                // ‰ªéHEXËæìÂÖ•Êõ¥Êñ∞
                const updateFromHex = () => {
                    let val = hexInput.value.trim();
                    if (!val.startsWith('#')) val = '#' + val;
                    if (/^#[0-9A-Fa-f]{6}$/.test(val)) {
                        const hsl = hexToHsl(val);
                        hSlider.value = hsl.h;
                        sSlider.value = hsl.s;
                        lSlider.value = hsl.l;
                        values[0].value = hsl.h;
                        values[1].value = hsl.s;
                        values[2].value = hsl.l;
                        document.documentElement.style.setProperty(item.var, val.toUpperCase());
                        preview.style.background = val;
                        hexInput.value = val.toUpperCase();
                        updateSliderGradients(hsl.h, hsl.s, hsl.l);
                        persistToCache(val.toUpperCase());
                    }
                };

                // ‰ªéHSLÊï∞ÂÄºËæìÂÖ•Êõ¥Êñ∞
                const updateFromValues = () => {
                    hSlider.value = Math.max(0, Math.min(360, +values[0].value || 0));
                    sSlider.value = Math.max(0, Math.min(100, +values[1].value || 0));
                    lSlider.value = Math.max(0, Math.min(100, +values[2].value || 0));
                    updateFromSliders();
                };

                // ÂàùÂßãÂåñÊ∏êÂèò
                updateSliderGradients(hsl.h, hsl.s, hsl.l);

                hSlider.addEventListener('input', updateFromSliders);
                sSlider.addEventListener('input', updateFromSliders);
                lSlider.addEventListener('input', updateFromSliders);
                hexInput.addEventListener('change', updateFromHex);
                values.forEach(v => v.addEventListener('change', updateFromValues));

                colorItems.push({ var: item.var, default: item.default, label: item.label, hSlider, sSlider, lSlider, preview, hexInput, values, updateSliderGradients });
                groupDiv.appendChild(div);
            });

            container.appendChild(groupDiv);
        });

        // ÂºÄÂÖ≥Èù¢Êùø
        const panel = document.getElementById('color-panel');
        const toggle = document.getElementById('color-panel-toggle');
        toggle.addEventListener('click', () => {
            panel.classList.toggle('open');
            toggle.classList.toggle('shifted');
        });

        // ÂØºÂá∫
        document.getElementById('export-colors').addEventListener('click', () => {
            const colors = {};
            colorItems.forEach(ci => {
                colors[ci.label] = ci.hexInput.value;
            });
            const json = JSON.stringify(colors, null, 2);
            navigator.clipboard.writeText(json).then(() => {
                alert('ÈÖçËâ≤ÊñπÊ°àÂ∑≤Â§çÂà∂Âà∞Ââ™Ë¥¥ÊùøÔºÅ\n\n' + json);
            });
        });

        // ‰ªé JSON ÂØºÂÖ•
        document.getElementById('import-colors').addEventListener('click', () => {
            const input = prompt('ËØ∑Á≤òË¥¥‰πãÂâçÂØºÂá∫ÁöÑÈÖçËâ≤ JSONÔºö', '');
            if (!input) return;

            let data;
            try {
                data = JSON.parse(input);
            } catch (e) {
                alert('JSON Ëß£ÊûêÂ§±Ë¥•ÔºåËØ∑Á°ÆËÆ§ÂÜÖÂÆπÊòØÂê¶ÂÆåÊï¥„ÄÇ');
                return;
            }

            if (!data || typeof data !== 'object' || Array.isArray(data)) {
                alert('Ê†ºÂºè‰∏çÊ≠£Á°ÆÔºåÂ∫î‰∏∫ { "Ê†áÁ≠æ": "#RRGGBB" } ÁªìÊûÑ„ÄÇ');
                return;
            }

            let applied = 0;
            colorItems.forEach(ci => {
                const raw = data[ci.label];
                if (!raw || typeof raw !== 'string') return;

                let val = raw.trim();
                if (!val.startsWith('#')) val = '#' + val;
                if (!/^#[0-9A-Fa-f]{6}$/.test(val)) return;
                val = val.toUpperCase();

                const hsl = hexToHsl(val);
                ci.hSlider.value = hsl.h;
                ci.sSlider.value = hsl.s;
                ci.lSlider.value = hsl.l;
                ci.preview.style.background = val;
                ci.hexInput.value = val;
                ci.values[0].value = hsl.h;
                ci.values[1].value = hsl.s;
                ci.values[2].value = hsl.l;
                ci.updateSliderGradients(hsl.h, hsl.s, hsl.l);
                document.documentElement.style.setProperty(ci.var, val);
                cachedColors[ci.var] = val;
                applied++;
            });

            if (applied > 0) {
                saveCache(cachedColors);
                alert('Â∑≤‰ªé JSON ÊÅ¢Â§çÈÖçËâ≤ÔºàÊõ¥Êñ∞‰∫Ü ' + applied + ' È°πÔºâ„ÄÇ');
            } else {
                alert('Êú™ÊâæÂà∞ÂèØÂ∫îÁî®ÁöÑÈÖçËâ≤Êù°ÁõÆÔºåËØ∑Ê£ÄÊü•Ê†áÁ≠æÊòØÂê¶ÂåπÈÖç„ÄÇ');
            }
        });

        // ÈáçÁΩÆ
        document.getElementById('reset-colors').addEventListener('click', () => {
            clearCache();
            colorItems.forEach(ci => {
                const hsl = hexToHsl(ci.default);
                ci.hSlider.value = hsl.h;
                ci.sSlider.value = hsl.s;
                ci.lSlider.value = hsl.l;
                ci.preview.style.background = ci.default;
                ci.hexInput.value = ci.default.toUpperCase();
                ci.values[0].value = hsl.h;
                ci.values[1].value = hsl.s;
                ci.values[2].value = hsl.l;
                ci.updateSliderGradients(hsl.h, hsl.s, hsl.l);
                document.documentElement.style.setProperty(ci.var, ci.default);
            });
        });
    })();
    </script>
</body>

</html>